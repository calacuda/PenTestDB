# syntax=docker/dockerfile:1
FROM rust:1.71.1-buster

WORKDIR /root
# COPY configs/.config/ptdb ./.config/ptdb

ENV WORDLIST=dir-list-common.txt

# install rust nightly
RUN rustup toolchain install nightly
RUN rustup default nightly

# install test dependencies
RUN apt update -y
RUN apt install nmap iputils-ping curl iproute2 postgresql dnsutils fping colorized-logs python3 screen -y
# RUN wget https://www.python.org/ftp/python/3.11.3/Python-3.11.3.tgz 
# RUN tar xzf Python-3.11.3.tgz
# WORKDIR ./Python-3.11.3
# RUN ./configure --enable-optimizations
# RUN make altinstall
# feroxbuster
RUN curl -sL https://raw.githubusercontent.com/epi052/feroxbuster/master/install-nix.sh | bash
RUN cp ./feroxbuster /usr/bin/feroxbuster
# gobuster
RUN wget https://github.com/OJ/gobuster/releases/download/v3.5.0/gobuster_3.5.0_Linux_x86_64.tar.gz
RUN tar xzf gobuster_3.5.0_Linux_x86_64.tar.gz
RUN cp ./gobuster /usr/bin/gobuster
# rustscan
RUN cargo install rustscan


WORKDIR /root/code

# get wordlists for directory brute force
RUN echo "index" >> $WORDLIST
RUN echo "robots.txt" >> $WORDLIST
RUN echo "css" >> $WORDLIST
RUN echo "js" >> $WORDLIST
RUN echo "index.html" >> $WORDLIST
RUN echo "source ~/.ptdb_start.sh" >> ~/.bashrc

# RUN mkdir -p /tmp/ptdb/logs/
RUN chsh -s $(which bash)

# CMD ["bash", "tests/test.sh"]
