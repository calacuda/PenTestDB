# will dump all dns data
query {
  getDNSNames(func: type(DNSName)) 
  {
    DNSName.name
    DNSName.points_to: ~DNSName.pointed_to {
    	DNSName.name
    }
    DNSName.machine: ~Machine.dns_names {
			Machine.ip
    }
  }
}

# will get machines ip, dns info, and all ports for any machine that has port 80 open. 
query {
  getMachine(func: type(Port)) 
  @filter(eq(Port.port, 80) AND eq(Port.state, "open"))
  # @normalize
  {
    # Port.port
    Port.mahcine: ~Machine.ports
    {
      Machine.ip
      Machine.dns_names: ~DNSName.machine {
				DNSName.name
        DNSName.points_to: ~DNSName.pointed_to {
          DNSName.name
        }
      }
      Mahcine.ports: ~Port.machine {
        Port.port
        # Port.state
        # Port.tl_protocol
        Port.service
        Port.version
        # Port.command 
        # {
        #   Command.command
        # }
      }
    }
  }
}

# get the machine ip, dns_name and ports
query {
  getMachine(func: type(Machine)) 
  # @filter(has(Machine.dns_names)) 
    {
    Machine.ip
    Mahcine.ports: ~Port.machine
    # @filter(eq(Ports.port, 80))
    {
      Port.port
      Port.state
      Port.tl_protocol
      Port.service
      Port.command {
        Command.command
      }
    }
    Machine.dns_names: ~DNSName.machine {
      DNSName.name
      DNSName.pointed_to: ~DNSName.points_to {
        DNSName.name
      }
    }
  }
}

# machines that have a port that is 443, or 80
query {
	q4(func: eq(Port.port, [443, 80])) {
    uid
    Port.port
    Port.machine: ~Machine.ports
    # @filter(eq(Machine.ip, "192.168.1.42")) 
    {
        uid
        Machine.ip
    }
  }
}

# machines (and all known ports) as long as port 80 is open
query {
  getMachine(func: type(Port)) 
  @filter(eq(Port.port, 80) AND eq(Port.state, "open"))
  # @normalize
  {
    # Port.port
    Port.mahcine: ~Machine.ports
    { 
      # uid
      Machine.ip
      Machine.dns_names: ~DNSName.machine {
				DNSName.name
        DNSName.pointed_to: ~DNSName.points_to {
        	DNSName.name
        }
      }
      Mahcine.ports: ~Port.machine {
        Port.port
        # Port.state
        # Port.tl_protocol
        Port.service
        Port.version
        # Port.command 
        # {
        #   Command.command
        # }
      }
    }
  }
}

#
query {
	getAllPorts(func: type(Port))
  {
    uid
		Port.port			
  }
}
