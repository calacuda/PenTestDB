#!/usr/bin/bash

install.sh
nmap -n $TARGET-IP | ptdb parse -q --exit-status $? --command "nmap -n $TARGET-IP"
nmap -n -sV $TARGET-IP | ptdb parse -q --exit-status $? --command "nmap -n -sV $TARGET-IP"

# feroxbuster -w $WORDLIST -u $TARGET-IP | ptdb parse -q --exit-status $? --command "feroxbuster -w $WORDLIST -u $TARGET-IP"
# gobuster dir -w $WORDLIST -u $TARGET-IP | ptdb parse -q --exit-status $? --command "gobuster dir -w $WORDLIST -u $TARGET-IP"

# rustscan -a $TARGET-IP | ptdb parse -q --exit-status $? --command "rustscan -a $TARGET-IP"

if [[ ! (ptdb query -q "SELECT * FROM machines;" | diff ./tests/db-output/machines-sql.txt - ) ]] {
    echo "FAILED"
    exit 1
}
if [[ ! (ptdb query -q "SELECT * FROM ports;" | diff ./tests/db-output/ports-sql.txt - ) ]] {
    echo "FAILED"
    exit 1
}
# if [[ ! (ptdb query -q "SELECT * FROM web_dirs;" | diff ./tests/db-output/web_dirs-sql.txt - ) ]] {
#     echo "FAILED"
#     exit 1
# }
echo "PASSED"
exit 0