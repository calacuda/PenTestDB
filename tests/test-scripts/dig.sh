function dig_data {
    echo "    [LOG] dig query"
    echo "    >> dig $TARGET_IP $DB_IP"
    echo -n "    "
    # target/debug/ptdb query -q "SELECT dns_name, record_type, machines.id, commands.id FROM machines JOIN commands ON commands.id = machines.command_uid JOIN dns_names ON dns_names.machine_uid = machines.id ORDER BY ip ASC;" 1>&2
    dig $TARGET_IP $DB_IP | target/debug/ptdb parse --exit-status $? --command "dig $TARGET_IP $DB_IP"
}

function dig_test {
    cmd_uid=$( target/debug/ptdb query -q "SELECT id FROM commands WHERE command = 'dig $TARGET_IP $DB_IP';" | head -n 3 | tail -n 1 )
    # target/debug/ptdb query -q "SELECT * FROM machines JOIN commands ON commands.id = machines.command_uid WHERE commands.id = $cmd_uid ORDER BY ip ASC;" > ./tests/db-output/dig-sql.txt  # dig-db-query.txt  # 
    # target/debug/ptdb query -q "SELECT * FROM dns_names ORDER BY dns_name ASC;" >> ./tests/db-output/dig-sql.txt  # dig-db-query.txt  # 
    target/debug/ptdb query -q "SELECT dns_name, record_type FROM machines JOIN commands ON commands.id = machines.command_uid JOIN dns_names ON dns_names.machine_uid = machines.id WHERE commands.id = $cmd_uid ORDER BY ip ASC;" > ./tests/db-output/dig-sql.txt  # dig-db-query.txt  # 
    
    if [[ $( diff -adE ./tests/db-output/dig-sql.txt dig-db-query.txt ) ]]; then
        echo -e '\a' 1>&2
        echo ">> diff -adE ./tests/db-output/dig-sql.txt dig-db-query.txt" 1>&2
        diff -adE ./tests/db-output/dig-sql.txt dig-db-query.txt 1>&2
        echo "[LOG] DIG test FAILED"
        exit 1
    else
        echo "[LOG] DIG test PASSED"
        exit 0
    fi
}