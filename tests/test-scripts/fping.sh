IP=$(ip a | grep "inet " | tail -n 1 | cut -d ' ' -f 6)

function fping_data {
    
    echo "    [LOG] fping scan"
    echo "    >> fping -ag $IP 2> /dev/null"
    echo -n "    "
    fping -ag $IP  2> /dev/null | target/debug/ptdb parse --exit-status $? --command "fping -ag $IP "
    # nmap -n -sV $DB_IP $TARGET_IP
}

function fping_test {
    # echo "    [LOG] checking PORTS"
    cmd_uid=$( target/debug/ptdb query -q "SELECT id FROM commands WHERE command = 'fping -ag $IP';" | head -n 3 | tail -n 1 )
    target/debug/ptdb query -q "SELECT ipv6, mac_adr, local_name FROM machines JOIN commands ON commands.id = machines.command_uid ORDER BY ip ASC;" > fping-db-query.txt  # ./tests/db-output/fping-sql.txt  # 
    if [[ $( diff -adE ./tests/db-output/fping-sql.txt fping-db-query.txt ) ]]; then
        echo -e '\a' 1>&2
        echo ">> diff -adE ./tests/db-output/fping-sql.txt fping-db-query.txt" 1>&2
        diff -adE ./tests/db-output/fping-sql.txt fping-db-query.txt 1>&2
        echo "[LOG] FPING test FAILED"
        exit 1
    else
        echo "[LOG] FPING test PASSED"
        exit 0
    fi
}