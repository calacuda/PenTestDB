function rustscan_data {    
    echo "    [LOG] rustscan scan"
    echo "    >> rustscan -p 5432,8888 -a $TARGET_IP -- -sV"
    echo -n "    "
    # rustscan -p 5432,8888 -a $TARGET_IP -- -sV > tests/db-output/rustscan_test.cmd_output
    rustscan -p 5432,8888 -a $TARGET_IP -- -sV | target/debug/ptdb parse --exit-status $? --command "rustscan -p 5432,8888 -a $TARGET_IP -- -sV"
}

function rustscan_test {
    # echo "    [LOG] checking PORTS"
    cmd_uid=$( target/debug/ptdb query -q "SELECT id FROM commands WHERE command = 'rustscan -p 5432,8888 -a $TARGET_IP -- -sV';" | head -n 3 | tail -n 1 )
    # target/debug/ptdb query -q "SELECT id FROM commands WHERE command = 'rustscan -p 5432,8888 -a $TARGET_IP -- -sV';" > tests/db-output/rustscan_test.cmd_id
    target/debug/ptdb query -q "SELECT port, state, tl_protocol, service, version FROM ports JOIN commands ON commands.id = ports.command_uid ORDER BY port ASC;" | sort > rustscan-db-query.txt  # ./tests/db-output/rustscan-sql.txt  # 
    
    if [[ $( diff -adEw ./tests/db-output/rustscan-sql.txt rustscan-db-query.txt ) ]]; then
        echo -e '\a' 1>&2
        echo ">> diff -adEw ./tests/db-output/rustscan-sql.txt rustscan-db-query.txt" 1>&2
        diff -adEw ./tests/db-output/rustscan-sql.txt rustscan-db-query.txt 1>&2
        echo "[LOG] RUSTSCAN test FAILED"
        exit 1
    else
        echo "[LOG] RUSTSCAN test PASSED"
        exit 0
    fi
}
