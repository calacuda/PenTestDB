#!/usr/bin/python3
"""
gobuster-parser.py

simple parser for gobuster output.


By: Calacuda | MIT License | Epoch: Aug 3rd, 2022,
"""


import re
import sys


ip_re = "([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})"
nul = chr(0)


def get_from_header(output, start):
    for line in output:
        if line.startswith(start):
            return line.split(' ')[-1].strip()


def get_dirs(output, url):
    dir_lines = [line.strip() for line in output if line.strip().startswith('/')]
    # print(dir_lines)
    data = []

    for line in dir_lines:
        line = [l for l in line.split(' ') if l and l != "(Status:" and l != "[Size:" and l != "[-->"]
        # print("line : ", line)
        out_line = ""
        out_line += f"url{nul}'{url + line[0]}'{nul}"
        for var_name, value in zip(["res_code", "num_chars", "redirect_adr"], line[1:]):
            # if not var_name.startswith("_"):
            out_line += f"{var_name}{nul}'{value.replace(')', '').replace(']', '')}'{nul}"
        
        data.append(out_line[0:-1])
    
    return data        


def main(output):
    target = get_from_header(output, "[+] Url:")
    method = get_from_header(output, "[+] Method:")
    host_name = target.split("://")[1]
    web_protocol = target.split(':')[0]
    host_type = "dns_name" if not re.search(ip_re, host_name) else "ip"
    prepend_data = f"base_url{nul}'{target}'{nul}method{nul}'{method}'{nul}web_protocol{nul}'{web_protocol}'{nul}{host_type}{nul}'{host_name}'{nul}"
    output_data = [prepend_data + l for l in get_dirs(output, target)]
    # print(output_data)
    # print()
    for line in output_data[0:-1]:
        print(line)
        
    print(output_data[-1], end='')
    # print(output_data, end='')


if __name__ == "__main__":
    main(sys.stdin.readlines())
