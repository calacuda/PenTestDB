-- tables
CREATE TABLE ports (
  id serial PRIMARY KEY NOT NULL,
  host varchar(255) NOT NULL, -- pointer to id of 'hosts' table
  port varchar(255) NOT NULL,
  state varchar(255) DEFAULT '',
  TL_protocol varchar(255) DEFAULT '', -- transport layer protocol tcp or udp
  service varchar(255) DEFAULT '',
  version varchar(255) DEFAULT '',
  command varchar(255) DEFAULT '', -- NOT NULL -- pointer to id of 'commands' table
  -- CONSTRAINT order_unique UNIQUE (id),
  UNIQUE (port, host, state, service, TL_protocol, version)
  -- UNIQUE (port, host, state)
  -- UNIQUE (port, host),
  -- UNIQUE (port, host, state)
);

CREATE TABLE web_dirs (
  id serial PRIMARY KEY NOT NULL,
  host varchar(255) NOT NULL, -- pointer to id of 'hosts' table
  url varchar(255) NOT NULL,
  base_url varchar(255) NOT NULL,
  res_code varchar(255) NOT NULL,
  web_protocol varchar(255) NOT NULL,
  method varchar(255) NOT NULL,
  num_chars varchar(255) DEFAULT '',
  -- wordlist varchar(255),
  command varchar(255) NOT NULL, -- pointer to id of 'commands' table
  UNIQUE (command, host, url, res_code, web_protocol)

);

CREATE TABLE passwds (
  id serial PRIMARY KEY NOT NULL,
  host varchar(255) DEFAULT '', -- pointer to id of 'hosts' table
  user_name varchar(255) DEFAULT '',
  pass_wd varchar(255) DEFAULT '',
  local BOOLEAN,
  ssh BOOLEAN,
  ftp BOOLEAN,
  command varchar(255) DEFAULT '', -- pointer to id of 'commands' table
  -- CONSTRAINT order_unique UNIQUE (id),
  UNIQUE (user_name, pass_wd, host) -- maybe add host?
  -- UNIQUE ()
);

CREATE TABLE hosts (
  id serial PRIMARY KEY NOT NULL,
  ip varchar(255) DEFAULT '',
  ipv6 varchar(255) DEFAULT '',
  mac_adr varchar(255) DEFAULT '',
  local_host_name varchar(255) DEFAULT '', -- if i know the local host name
  dns_name varchar(255) DEFAULT '',
  gateway_to varchar(255) DEFAULT '', -- gateway to this box form the outside world
  gateway_from varchar(255) DEFAULT '', -- gateway from this box to the outside world
  -- CONSTRAINT order_unique UNIQUE (id),
  constraint chk_null check (ip is not null or ipv6 is not null or mac_adr is not null or local_host_name is not null or dns_name is not null),
  -- constraint chk_uniq check (ip is UNIQUE or ipv6 is UNIQUE),
  UNIQUE (ip, ipv6, dns_name)
  -- UNIQUE (ipv6),
  -- UNIQUE (ip)
  -- UNIQUE()
);

CREATE TABLE commands (
  id serial PRIMARY KEY NOT NULL,
  cmd varchar(255) NOT NULL,
  local_time varchar(255) NOT NULL,
  -- output varchar(10240),
  -- CONSTRAINT order_unique UNIQUE (id),
  UNIQUE (cmd),
  UNIQUE (local_time)
)
