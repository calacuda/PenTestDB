-- tables
CREATE TABLE ports (
  id serial PRIMARY KEY NOT NULL,
  host_uid INTEGER NOT NULL,
  port varchar(255) NOT NULL,
  state varchar(255) DEFAULT '',
  TL_protocol varchar(255) DEFAULT '', -- transport layer protocol tcp or udp
  service varchar(255) DEFAULT '',
  version varchar(255) DEFAULT '',
  command_uid INTEGER NOT NULL, -- NOT null
  UNIQUE (port, host_uid, state, service, TL_protocol, version)
  -- UNIQUE (port, host_uid, state)
  -- UNIQUE (port, host_uid),
  -- UNIQUE (port, host_uid, state)
);

CREATE TABLE web_dirs (
  id serial PRIMARY KEY NOT NULL,
  host_uid INTEGER NOT NULL,
  dir varchar(255) DEFAULT '',
  url varchar(255) DEFAULT '',
  base_url varchar(255) NOT NULL,
  res_code varchar(255) NOT NULL,
  web_protocol varchar(255) NOT NULL,
  method varchar(255) NOT NULL,
  num_chars varchar(255) DEFAULT '',
  redirect_adr varchar(255) DEFAULT '',
  -- wordlist varchar(255),
  command_uid INTEGER NOT NULL, -- pointer to id of 'commands' table
  constraint chk_null check (NOT dir = '' OR NOT url = ''),
  UNIQUE (host_uid, base_url, dir, url, res_code, web_protocol, num_chars, method)
);

CREATE TABLE creds (
  id serial PRIMARY KEY NOT NULL,
  host_uid INTEGER DEFAULT 0,
  username varchar(255) DEFAULT '',
  password varchar(255) DEFAULT '',
  wordlist varchar(255) DEFAULT '',
  hash_file varchar(255) DEFAULT '',
  domain varchar(255) DEFAULT '', -- where this username and password can be used. (local, ssh, ftp, web, etc), if multiple domains, there will be multiple rows.
  command_uid INTEGER NOT NULL, -- pointer to id of 'commands' table
  port_uid INTEGER DEFAULT 0, -- pointer to the id of the 'ports' table
  -- CONSTRAINT order_unique UNIQUE (id),
  UNIQUE (username, password, host_uid, hash_file) -- don't add wordlist (see, REASON #1 bellow) -- maybe add host?
  -- REASON #1: passwd-username combo will be added again for each passwd cracking atempt with
  --            different wordlists
  -- UNIQUE ()
);

CREATE TABLE hosts (
  id serial PRIMARY KEY NOT NULL,
  ip varchar(255) DEFAULT '',
  ipv6 varchar(255) DEFAULT '',
  mac_adr varchar(255) DEFAULT '',
  local_name varchar(255) DEFAULT '',
  dns_name varchar(255) DEFAULT '',
  gateway_to varchar(255) DEFAULT '', -- gateway to this box form the outside world  (useful for machines that require pivoting to get to.)
  -- gateway_from varchar(255) DEFAULT '', -- gateway from this box to the outside world  -- can't think of a use, maybe add later
  constraint chk_null check (ip is not null or ipv6 is not null or mac_adr is not null or local_name is not null or dns_name is not null),
  -- constraint chk_uniq check (ip is UNIQUE or ipv6 is UNIQUE),
  UNIQUE (ip, ipv6, dns_name, mac_adr)
  -- UNIQUE (ipv6),
  -- UNIQUE (ip)
  -- UNIQUE()
);

CREATE TABLE commands (
  id serial PRIMARY KEY NOT NULL,
  command varchar NOT NULL,
  local_time varchar(255) NOT NULL,
  -- exit_status varchar(255) DEFAULT '',
  -- output varchar(10240),
  -- CONSTRAINT order_unique UNIQUE (id),
  -- UNIQUE (command),
  -- UNIQUE (local_time)
  UNIQUE (command, local_time)
)
