# syntax=docker/dockerfile:1
FROM rust:latest

WORKDIR /root
COPY configs/.config/ptdb ./.config/ptdb

ENV WORDLIST=dir-list-common.txt

# install rust nightly
RUN rustup toolchain install nightly
RUN rustup default nightly
# RUN echo "deb http://http.kali.org/kali kali-rolling main contrib non-free non-free-firmware" >> /etc/apt/sources.list
# RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys ED444FF07D8D0BF6

# install test depedencies
RUN apt update
RUN apt install nmap iputils-ping curl iproute2 python3 python-is-python3 postgresql dnsutils fping -y
# feroxbuster
RUN curl -sL https://raw.githubusercontent.com/epi052/feroxbuster/master/install-nix.sh | bash
RUN cp ./feroxbuster /usr/bin/feroxbuster
# gobuster
RUN wget https://github.com/OJ/gobuster/releases/download/v3.5.0/gobuster_3.5.0_Linux_x86_64.tar.gz
RUN tar xzf gobuster_3.5.0_Linux_x86_64.tar.gz
RUN cp ./gobuster /usr/bin/gobuster
RUN git clone https://github.com/RustScan/RustScan.git
# rustscan
WORKDIR /root/RustScan
RUN cargo build --release
RUN cp target/release/rustscan /usr/bin/rustscan


WORKDIR /root/code

# get wordlists for directory brute force
RUN echo "index" >> $WORDLIST
RUN echo "robots.txt" >> $WORDLIST
RUN echo "css" >> $WORDLIST
RUN echo "js" >> $WORDLIST
RUN echo "index.html" >> $WORDLIST

CMD ["bash", "tests/test.sh"]
